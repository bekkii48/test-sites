<!doctype html> <html lang="ru"> <meta charset="utf-8"> <title>Демо «как Meet»: шаринг вкладки</title>
<button id="share">Поделиться</button>
<video id="v" autoplay playsinline></video>
<script> document.getElementById('share').addEventListener('pointerdown', async (e) => { e.preventDefault(); console.log('isActive before:', navigator.userActivation?.isActive); // должно быть true try { const controller = 'CaptureController' in window ? new CaptureController() : undefined; if (controller) controller.setFocusBehavior('focus-captured-surface'); const stream = await navigator.mediaDevices.getDisplayMedia({ video: { cursor: 'always' }, audio: true, preferCurrentTab: true, surfaceSwitching: 'include', selfBrowserSurface: 'include', controller }); v.srcObject = stream; stream.getVideoTracks()[0].onended = () => { v.srcObject = null; }; } catch (e2) { console.log('getDisplayMedia error:', e2.name, e2.message); } }); </script>